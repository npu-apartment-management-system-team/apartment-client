import{s as y,c as V,b as B,F as S,L as $,B as F,S as D,e as T,f as z,R as H,g as R}from"./vant-60b60113.js";import{_ as U}from"./index-42dc619c.js";import{_ as G}from"./index-995aa90f.js";import{b as p,c as I,R as f,V as w,C as s,U as e,W as A,J as b,K as _,$ as E,S as J,X as v}from"./@vue-802b571a.js";import"./@vant-176bc72f.js";import"./axios-4a70c6fc.js";import"./js-cookie-edb2da2a.js";import"./pinia-f48910fc.js";import"./@vueuse-94ed6524.js";import"./vue-router-05758286.js";import"./pinia-plugin-persistedstate-c44f3b64.js";const K=i=>{B({duration:0,forbidClick:!0,message:i})},Q=async i=>{K("正在加载消息列表");try{const{data:l}=await U.get("/api/message/sender/outbox",{params:i});return l}catch{y({type:"danger",message:"加载消息列表失败"})}finally{V()}return null};const W={class:"message-card-container"},X={__name:"MessageHome",setup(i){const l=p(!1),u=p(!1),o=p({pageNum:1,pageSize:10,query:""}),r=p([]);let m={query:""},c=!0;const d=async()=>{c?c=!c:o.value.pageNum++,m.query!==o.value.query&&(c=!0,o.value.pageNum=1,l.value=!1),u.value=!0;const a=await Q(o.value);a===null&&y({type:"danger",message:"获取消息列表失败: 服务器错误"}),a.code===2e3?(console.log(a),m.query!==o.value.query?(r.value=[],r.value.push(...a.result.list),console.log(r.value),m={query:o.value.query}):(console.log(a.result),r.value.push(...a.result.list),console.log(1)),a.total!==o.value.pageSize&&(l.value=!0)):y({type:"danger",message:`获取消息列表失败：${a.msg}`}),u.value=!1};I(async()=>{await d()});const C=async a=>{await router.push(`/main/passenger/carpooling-detail?id=${a.id}`)};return(a,n)=>{const L=F,k=D,h=T,x=S,g=z,q=H,N=R,M=$;return f(),w(b,null,[s(x,{class:"searchForm"},{default:e(()=>[s(h,{inset:""},{default:e(()=>[s(k,{label:"搜索",modelValue:o.value.query,"onUpdate:modelValue":n[1]||(n[1]=t=>o.value.query=t),"show-action":"",placeholder:"请输入搜索关键词",onClear:n[2]||(n[2]=t=>d())},{action:e(()=>[s(L,{plain:"",block:"",type:"primary",size:"mini",onClick:n[0]||(n[0]=t=>d())},{default:e(()=>[_(" 搜索 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),A("div",W,[s(M,{loading:u.value,"onUpdate:loading":n[3]||(n[3]=t=>u.value=t),finished:l.value,"finished-text":"没有更多消息了",onLoad:d},{default:e(()=>[(f(!0),w(b,null,E(r.value,t=>(f(),J(h,{inset:"",style:{"margin-top":"2%"},key:t},{default:e(()=>[s(N,{class:"carpoolingItem",onClick:j=>C(t)},{default:e(()=>[s(q,null,{default:e(()=>[s(g,{span:"12"},{default:e(()=>[_(v(t.createTime),1)]),_:2},1024)]),_:2},1024),s(q,null,{default:e(()=>[s(g,{span:"6"},{default:e(()=>[_(v(t.senderAdminName),1)]),_:2},1024),s(g,{span:"18"},{default:e(()=>[_(v(t.message.slice(0,10))+"... ",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1},8,["loading","finished"])])],64)}}},re=G(X,[["__scopeId","data-v-cad920b4"]]);export{re as default};
