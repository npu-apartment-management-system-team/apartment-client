import{s as h,F as b,L as B,B as S,S as $,e as D,f as F,R,g as z}from"./vant-60b60113.js";import{h as U}from"./index-93d19b15.js";import{u as A}from"./vue-router-05758286.js";import{_ as G}from"./index-7c043e02.js";import{b as d,c as I,R as v,V as q,C as t,U as a,W as T,J as L,K as l,$ as E,S as J,X as p}from"./@vue-802b571a.js";import"./@vant-176bc72f.js";import"./index-4cb3d558.js";import"./axios-4a70c6fc.js";import"./js-cookie-edb2da2a.js";import"./pinia-f48910fc.js";import"./@vueuse-94ed6524.js";import"./pinia-plugin-persistedstate-c44f3b64.js";const K={class:"message-card-container"},Q={__name:"MessageList",setup(W){const w=A(),_=d(!1),i=d(!1),s=d({pageNum:1,pageSize:10,query:""}),r=d([]);let m={query:""},u=!0;const c=async()=>{try{u?u=!u:s.value.pageNum++,m.query!==s.value.query&&(u=!0,s.value.pageNum=1,_.value=!1),i.value=!0;const o=await U(s.value);o===null&&h({type:"danger",message:"获取消息列表失败: 服务器错误"}),o.code===2e3?(m.query!==s.value.query?(r.value=[],r.value.push(...o.result.list),m={query:s.value.query}):r.value.push(...o.result.list),o.total!==s.value.pageSize&&(_.value=!0)):h({type:"danger",message:`获取消息列表失败：${o.msg}`})}finally{i.value=!1}};I(async()=>{await c()});const C=async o=>{await w.push(`/main/message/message-detail?id=${o.id}`)};return(o,n)=>{const N=S,k=$,g=D,M=b,f=F,y=R,x=z,V=B;return v(),q(L,null,[t(M,{class:"searchForm"},{default:a(()=>[t(g,{inset:""},{default:a(()=>[t(k,{label:"搜索",modelValue:s.value.query,"onUpdate:modelValue":n[1]||(n[1]=e=>s.value.query=e),"show-action":"",placeholder:"请输入搜索关键词",onClear:n[2]||(n[2]=e=>c())},{action:a(()=>[t(N,{plain:"",block:"",type:"primary",size:"mini",onClick:n[0]||(n[0]=e=>c())},{default:a(()=>[l(" 搜索 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),T("div",K,[t(V,{loading:i.value,"onUpdate:loading":n[3]||(n[3]=e=>i.value=e),finished:_.value,"finished-text":"没有更多消息了",onLoad:c},{default:a(()=>[(v(!0),q(L,null,E(r.value,e=>(v(),J(g,{inset:"",style:{"margin-top":"2%"},key:e},{default:a(()=>[t(x,{class:"carpoolingItem",onClick:X=>C(e)},{default:a(()=>[l(p(e.isDeleted)+" ",1),t(y,{id:"time"},{default:a(()=>[t(f,{span:"24"},{default:a(()=>[l(p(e.createTime),1)]),_:2},1024)]),_:2},1024),t(y,{id:"NameAndMessage"},{default:a(()=>[t(f,{span:"6"},{default:a(()=>[l(p(e.senderAdminName),1)]),_:2},1024),t(f,{span:"18"},{default:a(()=>[l(p(e.message.slice(0,20))+"... ",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1},8,["loading","finished"])])],64)}}},le=G(Q,[["__scopeId","data-v-26b929c6"]]);export{le as default};
