import{a as L,s as l,b as v,c as C,I as N,F as P,B as z,d as E,e as j}from"./vant-60b60113.js";import{u as G}from"./vue-router-05758286.js";import{_ as x}from"./index-c6f38eea.js";import{e as K}from"./jsencrypt-da988b81.js";import{a as y}from"./js-cookie-edb2da2a.js";import{v as M,a as O,b as W}from"./validatorUtil-fa8d24ca.js";import{u as X}from"./index-e822aa76.js";import{_ as Y}from"./index-93101b1e.js";import{b as f,c as Z,R as m,V as q,W as u,C as n,U as r,K as h,X as H,u as U,S as _,Y as J,Z as Q,_ as ee}from"./@vue-802b571a.js";import"./@vant-176bc72f.js";import"./axios-4a70c6fc.js";import"./js-encrypt-af0330d8.js";import"./pinia-f48910fc.js";import"./@vueuse-94ed6524.js";import"./pinia-plugin-persistedstate-c44f3b64.js";const te=""+new URL("alipayLogo-e4ca2d5f.png",import.meta.url).href;const $=p=>(Q("data-v-1c045771"),p=p(),ee(),p),oe={class:"login-box"},se=$(()=>u("h1",{style:{"margin-top":"10%",color:"white"}},"员工公寓管理系统",-1)),ae={class:"icon-box"},ne={class:"form-box",id:"form-box"},re=$(()=>u("div",{style:{height:"5%"}},null,-1)),le={class:"submit-revise-btn"},ie={__name:"UserLogin",setup(p){const V=X(),c=G(),t=f({username:"",password:"",code:""}),d=f(!0),I=()=>{l({type:"danger",message:"表单校验未通过,请检查输入"});const o=document.getElementById("form-box");o.style.height="50%"},S=async()=>{v({duration:0,forbidClick:!0,message:"登录中"});const o={username:t.value.username,password:K(t.value.password)};try{y.remove("token");const{data:e}=await x.post("/api/auth/login/password",o);if(e.code!==null&&e.code===2e3){if(e.result.role!==8){v({duration:3e3,forbidClick:!0,message:"该账号为管理员账号,请使用管理端登录"});return}y.set("token",e.result.token),V.$patch(s=>{s.currentUser=e.result.user}),await c.push("/main/my/my-home")}else l({type:"danger",message:"用户名密码登录未通过,请检查输入"})}catch(e){l({type:"danger",message:`服务器异常${e},请通知管理员`})}finally{C()}},g=f(!0),w=f(""),F=async()=>{v({duration:0,forbidClick:!0,message:"请求验证码发送中"});const o={phone:t.value.username};try{const{data:e}=await x.post("/api/auth/sendsms",o);if(e.code!==null&&e.code===2e3){l({type:"success",message:"验证码已发送"}),w.value="300s",g.value=!1;let s=300;const i=setInterval(()=>{s--,w.value=s+"s",s===0&&(clearInterval(i),g.value=!0)},1e3)}else l({type:"danger",message:`验证码发送失败,${e.msg},请重试`})}catch(e){l({type:"danger",message:`服务器异常${e},请通知管理员`})}finally{C()}},B=async()=>{v({duration:0,forbidClick:!0,message:"登录中"});const o={phone:t.value.username,code:t.value.code};try{const e=await x.post("/api/auth/login/phone",o);e.data.code!==null&&e.data.code===2e3?(y.set("token",e.data.result.token),V.$patch(s=>{s.currentUser=e.data.result.user}),await c.push("/main/my/my-home")):l({type:"danger",message:"用户名短信登录未通过,请检查输入"})}catch(e){l({type:"danger",message:`服务器异常${e},请通知管理员`})}finally{C()}},A=()=>{window.location.replace("https://openapi-sandbox.dl.alipaydev.com/gateway.do/oauth2/publicAppAuthorize.htm?app_id=2021000121691518&scope=auth_user&redirect_uri=https%3A%2F%2Fapartment-server.wangminan.me%2Fapi%2Fauth%2Flogin%2Foauth%2Fcallback")},D=async()=>{await c.push("/register")};Z(async()=>{y.get("token")!==void 0&&await c.push("/main");const o=navigator.userAgent.toLowerCase(),e=o.indexOf("chrome")!==-1;if(e){const s=o.match(/chrome\/([\d.]+)/)[1];parseInt(s.split(".")[0])<51&&L({title:"我们建议您升级浏览器",message:"为了避免跳转、显示与样式的问题 , 我们建议您更新Chrome浏览器到51以上版本以获得更好的体验",theme:"round-button"}).then(()=>{window.sessionStorage.setItem("showUserAgentCheck","true")})}else e||L({title:"我们建议您更换浏览器",message:"为了避免跳转、显示与样式的问题 , 我们建议您更换为Chrome内核的浏览器以获得更好的体验",theme:"round-button"}).then(()=>{window.sessionStorage.setItem("showUserAgentCheck","true")})});const R=()=>new URL(""+new URL("apartment-93d4cbdb.svg",import.meta.url).href,self.location).href;return(o,e)=>{const s=N,i=z,b=E,k=j,T=P;return m(),q("div",oe,[se,u("div",ae,[n(s,{width:"60%",height:"60%",src:R()},null,8,["src"])]),u("div",ne,[re,n(T,{onSubmit:e[6]||(e[6]=a=>d.value?S():B()),onFailed:I},{default:r(()=>[n(i,{class:"login-type-choose-btn",style:{"margin-top":"0"},plain:"",block:"",type:"warning",onClick:e[0]||(e[0]=a=>d.value=!d.value)},{default:r(()=>[h(H(d.value?"切换到验证码登录":"切换到用户名密码登录"),1)]),_:1}),n(k,{style:{"margin-top":"5%"},inset:""},{default:r(()=>[n(b,{modelValue:t.value.username,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.username=a),name:"手机号",label:"手机号",placeholder:"请输入手机号",type:"tel",rules:[{validator:U(M),message:"请输入正确的手机号码"}]},null,8,["modelValue","rules"])]),_:1}),d.value?(m(),_(k,{key:0,inset:"",style:{"margin-top":"5%"}},{default:r(()=>[n(b,{modelValue:t.value.password,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.password=a),name:"密码",label:"密码",type:"password",placeholder:"请输入密码",autocomplete:"off",rules:[{validator:U(O),message:"应为4-16位数字/字母/下划线"}]},null,8,["modelValue","rules"])]),_:1})):(m(),_(k,{key:1,style:{"margin-top":"5%"},inset:""},{default:r(()=>[n(b,{modelValue:t.value.code,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.code=a),center:"",clearable:"",type:"digit",label:"短信验证码",placeholder:"请输入验证码",rules:[{validator:U(W),message:"应为4位数字"}]},{button:r(()=>[g.value?(m(),_(i,{key:0,size:"small",type:"primary",onClick:e[3]||(e[3]=a=>F())},{default:r(()=>[h(" 发送验证码 ")]),_:1})):g.value?J("",!0):(m(),_(i,{key:1,size:"small",type:"primary",disabled:"",loading:"","loading-text":w.value},null,8,["loading-text"]))]),_:1},8,["modelValue","rules"])]),_:1})),u("div",le,[n(i,{plain:"",block:"",type:"primary","native-type":"submit"},{default:r(()=>[h(" 登录 ")]),_:1}),n(i,{plain:"",block:"",type:"success",onClick:e[5]||(e[5]=a=>D())},{default:r(()=>[h(" 新账号注册 ")]),_:1})])]),_:1}),u("img",{onClick:e[7]||(e[7]=a=>A()),class:"alipay-icon",src:te,alt:"支付宝登录"})])])}}},xe=Y(ie,[["__scopeId","data-v-1c045771"]]);export{xe as default};
