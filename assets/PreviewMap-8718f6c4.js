import{b as h,s as f,c as M,N as k}from"./vant-51b1534e.js";import{A as $}from"./@amap-2c7a519d.js";import{u as b}from"./vue-router-05758286.js";import{u as L}from"./@vueuse-94ed6524.js";import{_ as R}from"./index-a4fae6cb.js";import{s as P,w as A,c as T,E as B,R as C,V as I,C as S,u as q,Z as x,_ as D,W as E}from"./@vue-802b571a.js";import"./@vant-176bc72f.js";import"./pinia-f48910fc.js";import"./js-cookie-edb2da2a.js";import"./pinia-plugin-persistedstate-c44f3b64.js";window._AMapSecurityConfig={serviceHost:"https://amap.wangminan.me/_AMapService/backup"};const N=async()=>await $.load({key:"488832cc9add2a49a6f41bf8b8dbf109",version:"2.0",plugins:["AMap.Driving","AMap.Geocoder","AMap.Geolocation","AMap.ToolBar"]});const V=p=>(x("data-v-30d51cd1"),p=p(),D(),p),W={class:"container"},z=V(()=>E("div",{id:"route-map"},null,-1)),G={__name:"PreviewMap",setup(p){const m=L(),n=b();let i=P(null),r,l,u;const d=async()=>{l=new r.LngLat(n.currentRoute.value.query.departureLng,n.currentRoute.value.query.departureLat),u=new r.LngLat(n.currentRoute.value.query.arriveLng,n.currentRoute.value.query.arriveLat)};function g(e){const t=w(e),a=new r.Marker({position:t[0],icon:"https://webapi.amap.com/theme/v1.3/markers/n/start.png",map:i.value}),o=new r.Marker({position:t[t.length-1],icon:"https://webapi.amap.com/theme/v1.3/markers/n/end.png",map:i.value}),s=new r.Polyline({path:t,isOutline:!0,outlineColor:"#ffeeee",borderWeight:2,strokeWeight:5,strokeColor:"#0091ff",lineJoin:"round"});s.setMap(i),i.value.setFitView([a,o,s])}function w(e){const t=[];let a=0,o=e.steps.length;for(;a<o;a++){const s=e.steps[a];let c=0,y=s.path.length;for(;c<y;c++)t.push(s.path[c])}return t}const v=async e=>{i.value=new e.Map("route-map",{resizeEnable:!0,mapStyle:m.value?"amap://styles/dark":"amap://styles/normal",viewMode:"3D",zoom:15,center:[120.182882,30.243486]}),new e.Driving({policy:e.DrivingPolicy.LEAST_TIME,map:i.value}).search(l,u,function(a,o){a==="complete"?o.routes&&o.routes.length&&g(o.routes[0]):f({type:"danger",message:"路线规划失败，请检查输入地点是否在杭州市范围内"})})};A(m,async e=>{console.log(e),await d(),await v(r)});const _=async()=>{const e=`${l.lng},${l.lat},${n.currentRoute.value.query.departurePoint}`,t=`${u.lng},${u.lat},${n.currentRoute.value.query.arrivePoint}`,a="car",o=0,s="gaode",c=1;window.location.href=`https://uri.amap.com/navigation?' +
            'policy=${o}&from=${e}&to=${t}&mode=${a}' +
            '&coordinate=${s}&callnative=${c}`};return T(async()=>{h({duration:0,forbidClick:!0,message:"正在加载地图..."});try{r=await N(),await d(),await v(r)}catch(e){f({type:"danger",message:`地图加载失败,${e.message}`})}finally{M()}}),B(()=>{document.getElementById("route-map").remove()}),(e,t)=>{const a=k;return C(),I("div",W,[S(a,{title:"行程预览","left-text":"返回","right-text":"使用高德地图打开","left-arrow":"",onClickLeft:t[0]||(t[0]=o=>q(n).go(-1)),onClickRight:t[1]||(t[1]=o=>_())}),z])}}},Y=R(G,[["__scopeId","data-v-30d51cd1"]]);export{Y as default};
